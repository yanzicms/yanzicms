/*** Created by A.J on 2020/10/23.*/$(document).ready(function(){var e=HE.getEditor("content",{height:"500px",autoHeight:!0,autoFloat:!0,topOffset:49,uploadPhoto:!0,uploadPhotoHandler:$("#upload_handyeditor_url").text(),uploadPhotoSize:2048,uploadPhotoType:"gif,png,jpg,jpeg,webp",uploadPhotoSizeError:$("#sizeError").text(),uploadPhotoTypeError:$("#typeError").text(),uploadParam:{allow:"gif,png,jpg,jpeg,webp",fullpath:"1"},skin:"yanzicms"}),l="";$("#imagefile").on("change",function(){""==l&&(l=$(this).next(".custom-file-label").html());var e=$(this).val();$(this).next(".custom-file-label").html(e),$("#imagefile").upload("uploadfile",{allow:"jpg,gif,png,jpeg,webp"},function(e){""!=e?($("#image").val(e),$("#imageimg").attr("src",$("#domain").text()+e),$("#imagediv").removeClass("d-none")):($("#imagefile").next(".custom-file-label").html(l),$.alert({title:$("#error").text(),content:$("#uploadfailed").text(),buttons:{confirm:{text:$("#ok").text(),btnClass:"btn-info",keys:["enter"]}}}))})}),$("#imagedel").on("click",function(){var t=$(this);$(this).children("div:last").removeClass("d-none"),$.post("uploadfiledel",{filename:$("#image").val()},function(e){t.children("div:last").addClass("d-none"),"ok"==e?($("#image").val(""),$("#imageimg").attr("src",""),$("#imagediv").addClass("d-none"),$("#imagefile").next(".custom-file-label").html(l)):$.alert({title:$("#error").text(),content:e,buttons:{confirm:{text:$("#ok").text(),btnClass:"btn-info",keys:["enter"]}}})})}),$("#selectmodel").on("change",function(){var e,d,n,m,r,s,p;0<$("#yanzicms").length&&($("#generativemodel").html(""),""!=$(this).val()&&(e=JSON.parse($("#model_"+$(this).val()).text()),n=[],m=[],r=[],s=[],p=[],$.each(e,function(e,l){var t,i,a,o;"video"==l.parttype?(d=$("#modelvideodiv").html().replace('id="modelvideodiv_"','id="modelvideodiv_'+l.partalias+'"').replace('id="modelvideodel_"','id="modelvideodel_'+l.partalias+'"').replace('id="modelvideoup_"','id="modelvideoup_'+l.partalias+'"').replace('id="modelvideo_"','id="modelvideo_'+l.partalias+'"').replace('for="modelvideo_"','for="modelvideo_'+l.partalias+'"'),r.push(l.partalias)):"annex"==l.parttype?(d=$("#modelfilediv").html().replace('id="modelfilediv_"','id="modelfilediv_'+l.partalias+'"').replace('id="modelfiledel_"','id="modelfiledel_'+l.partalias+'"').replace('id="modelfileup_"','id="modelfileup_'+l.partalias+'"').replace('id="modelfile_"','id="modelfile_'+l.partalias+'"').replace('for="modelfile_"','for="modelfile_'+l.partalias+'"'),s.push(l.partalias)):"multiplepictures"==l.parttype?(d=$("#multiplepicturesdiv").html().replace('id="multiimagediv_"','id="multiimagediv_'+l.partalias+'"').replace('id="multiimage_"','id="multiimage_'+l.partalias+'"').replace('id="multiimagefile_"','id="multiimagefile_'+l.partalias+'"').replace('name=""','name="'+l.partalias+'"'),p.push(l.partalias)):"date"==l.parttype?(d=$("#modeldatediv").html().replace('id=""','id="datepicker_'+l.partalias+'"'),n.push(l.partalias)):"datetime"==l.parttype?(d=$("#modeldatediv").html().replace('id=""','id="datetimepicker_'+l.partalias+'"'),m.push(l.partalias)):d="singlechoice"==l.parttype?$("#modelsinglechoicediv").html():"multiplechoice"==l.parttype?(t=l.defaults.replace(/，/g,",").split(","),i="",$.each(t,function(e,t){t=$.trim(t),i+=$("#multiplechoicediv").html().replace('id="modelmultiplechoicediv_"','id="modelmultiplechoicediv_'+l.partalias+"_"+e+'"').replace('for="modelmultiplechoicediv_"></label>','for="modelmultiplechoicediv_">'+t+"</label>").replace('for="modelmultiplechoicediv_"','for="modelmultiplechoicediv_'+l.partalias+"_"+e+'"').replace('value="" name=""','value="'+t+'" name="'+l.partalias+'[]"')}),$("#modelmultiplechoicediv").html().replace('<div class="multiplechoicediv"></div>','<div class="multiplechoicediv">'+i+"</div>")):"text"==l.parttype?$("#modeltextdiv").html():"int"==l.parttype?$("#modelintdiv").html():"decimal"==l.parttype?$("#modeldecimaldiv").html():$("#modeldiv").html(),$("#generativemodel").append(d),$("#generativemodel").children(":last").find("label:first").text(l.partname),"text"==l.parttype?$("#generativemodel").children(":last").find("textarea:first").attr("name",l.partalias):"singlechoice"==l.parttype?(a=l.defaults.replace(/，/g,",").split(","),(o=$("#generativemodel").children(":last").find("select:first")).attr("name",l.partalias),$.each(a,function(e,t){t=$.trim(t),o.append('<option value="'+t+'">'+t+"</option>")})):"multiplechoice"==l.parttype||"multiplepictures"==l.parttype||$("#generativemodel").children(":last").find("input:first").attr("name",l.partalias)}),$.each(n,function(e,t){$("#datepicker_"+t).datepicker({locale:"zh-cn",format:"yyyy-mm-dd",uiLibrary:"bootstrap4"})}),$.each(m,function(e,t){$("#datetimepicker_"+t).datetimepicker({locale:"zh-cn",format:"yyyy-mm-dd HH:MM:ss",uiLibrary:"bootstrap4",footer:!0,modal:!0})}),$.each(r,function(e,l){var i="";$("#modelvideo_"+l).on("change",function(){""==i&&(i=$(this).next(".custom-file-label").html());var e=$(this).val(),t=$(this);$(this).next(".custom-file-label").html(e),$(this).parent().next("small").removeClass("d-none"),$("#modelvideo_"+l).upload("uploadfile",{allow:"mp4,avi,mov,flv,rmvb,wmv,swf,mp3,wav,wma,mid,mpg,asf,rm,webm,ogg"},function(e){t.parent().next("small").addClass("d-none"),""!=e?($("#modelvideoup_"+l).val(e),$("#modelvideodiv_"+l).removeClass("d-none")):(t.next(".custom-file-label").html(i),$.alert({title:$("#error").text(),content:$("#uploadfailed").text(),buttons:{confirm:{text:$("#ok").text(),btnClass:"btn-info",keys:["enter"]}}}))})}),$("#modelvideodel_"+l).on("click",function(){var t=$(this);$(this).children("div:last").removeClass("d-none"),$.post("uploadfiledel",{filename:$("#modelvideoup_"+l).val()},function(e){t.children("div:last").addClass("d-none"),"ok"==e?($("#modelvideoup_"+l).val(""),$("#modelvideodiv_"+l).addClass("d-none"),$("#modelvideo_"+l).next(".custom-file-label").html(i)):$.alert({title:$("#error").text(),content:e,buttons:{confirm:{text:$("#ok").text(),btnClass:"btn-info",keys:["enter"]}}})})})}),$.each(s,function(e,l){var i="";$("#modelfile_"+l).on("change",function(){""==i&&(i=$(this).next(".custom-file-label").html());var e=$(this).val(),t=$(this);$(this).next(".custom-file-label").html(e),$(this).parent().next("small").removeClass("d-none"),$("#modelfile_"+l).upload("uploadfile",{allow:"doc,docx,xls,xlsx,ppt,htm,html,txt,zip,rar,gz,bz2,pdf"},function(e){t.parent().next("small").addClass("d-none"),""!=e?($("#modelfileup_"+l).val(e),$("#modelfilediv_"+l).removeClass("d-none")):(t.next(".custom-file-label").html(i),$.alert({title:$("#error").text(),content:$("#uploadfailed").text(),buttons:{confirm:{text:$("#ok").text(),btnClass:"btn-info",keys:["enter"]}}}))})}),$("#modelfiledel_"+l).on("click",function(){var t=$(this);$(this).children("div:last").removeClass("d-none"),$.post("uploadfiledel",{filename:$("#modelfileup_"+l).val()},function(e){t.children("div:last").addClass("d-none"),"ok"==e?($("#modelfileup_"+l).val(""),$("#modelfilediv_"+l).addClass("d-none"),$("#modelfile_"+l).next(".custom-file-label").html(i)):$.alert({title:$("#error").text(),content:e,buttons:{confirm:{text:$("#ok").text(),btnClass:"btn-info",keys:["enter"]}}})})})}),$.each(p,function(e,o){var d="";$("#multiimagefile_"+o).on("change",function(){""==d&&(d=$(this).next(".custom-file-label").html());var e=$(this).val(),i=$(this);$(this).next(".custom-file-label").html(e),$("#multiimagefile_"+o).upload("uploadfile",{allow:"jpg,gif,png,jpeg,webp"},function(e){var t,l;i.next(".custom-file-label").html(d),""!=e?(""==(t=$("#multiimage_"+o).val())?t=e:t+=","+e,$("#multiimage_"+o).val(t),l=$("#multiimagediv").html().replace('src=""','src="'+$("#domain").text()+e+'"').replace('data-img=""','data-img="'+e+'"').replace('class="multiimagedel multiimagedel_"','class="multiimagedel multiimagedel_'+o+'"'),$("#multiimagediv_"+o).append(l),$('[data-toggle="popover"]').popover("dispose").popover()):$.alert({title:$("#error").text(),content:$("#uploadfailed").text(),buttons:{confirm:{text:$("#ok").text(),btnClass:"btn-info",keys:["enter"]}}})})}),$("#multiimagediv_"+o).on("click",".multiimagedel_"+o,function(){var i=$(this),a=$(this).data("img");$(this).children("div:last").removeClass("d-none"),$.post("uploadfiledel",{filename:a},function(e){var t,l;i.children("div:last").addClass("d-none"),"ok"==e?(t=$("#multiimage_"+o).val().split(","),l="",$.each(t,function(e,t){t!=a&&(""==l?l=t:l+=","+t)}),$("#multiimage_"+o).val(l),i.parent().remove(),$("#multiimagefile_"+o).next(".custom-file-label").html(d)):$.alert({title:$("#error").text(),content:e,buttons:{confirm:{text:$("#ok").text(),btnClass:"btn-info",keys:["enter"]}}})})})}),$('[data-toggle="popover"]').popover()))}),$("#submit").on("click",function(){e.sync(),""==$("#summary").val()&&(500<e.getText().length?$("#summary").val(e.getText().replace(/\n/g," ").substr(0,500)+"..."):$("#summary").val(e.getText().replace(/\n/g," ")))})});